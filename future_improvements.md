# Future Improvements

- `lib/main.dart:22-49` — Load the theme asynchronously (e.g., from shared preferences via `ThemeService`) before building `MaterialApp`, and map `themeMode` to user preference instead of always returning `ThemeMode.system` with a hard-coded `ThemeData.dark()`; right now the switches in settings/profile never change the actual app theme.
- `lib/services/theme_service.dart:21-47` — Persist the selected theme, expose setters/listeners, and return user choice instead of the hard-coded `lightBlueTheme`; without this, every theme toggle in the UI has no lasting effect after restart or even within the current session.
- `lib/services/api_service.dart:1-104` — Remove unused imports, add offline failure paths, and mirror the real API contract (status codes, validation errors, token expiry) to keep UI logic honest before wiring to a backend; current mocks always report success so error handling elsewhere cannot be exercised.
- `lib/services/data_service.dart:18-143` — Wrap patient/file inserts inside a single transaction, surface duplicate-key errors (CRN `UNIQUE`) with user-friendly messages, and only flag records as synced when a remote push actually succeeds; at the moment the `synced` flag flips to 1 even though no server exists.
- `lib/services/local_db_service.dart:17-259` — Enable foreign keys in `onConfigure`, add forward-only migrations instead of dropping tables in `_onUpgrade`, handle conflict algorithms for `insert` calls, and reset `_database` to `null` after `close()` so a fresh connection is opened next time; dropping tables means any upgrade wipes data, and the stale handle makes reopen attempts flaky.
- `lib/services/export_service.dart:168-218` — Replace the non-existent `file['filepath']` usage by reconstructing files from the stored BLOB or by persisting real paths; while at it, stream large exports (CSV/PDF/JSON) to reduce memory pressure and copy the actual SQLite file for backups. As written, exporting a patient with attachments will throw because `filepath` is never stored.
- `lib/services/sync_service.dart:19-179` — Replace the offline stubs with real network calls through `ApiService`, track per-record failures, and avoid marking rows as synced until the backend acknowledges them; the “Sync” buttons currently just flip local flags, so no data ever leaves the device.
- `lib/services/notification_service.dart:19-205` — Register Android notification channels, request runtime permissions (Android 13+/iOS), call `tz.setLocalLocation`, and let callers supply real image bytes instead of the empty `Uint8List` placeholders in the big-picture template; otherwise scheduled or rich notifications will silently fail.
- `lib/services/utility_service.dart:25-77` — Zero-pad hours in `formatDateTime`, inject stronger randomness (UUID) into ID generators to avoid collisions, and ensure `copyFile`/`moveFile` create destination folders before writing; the current timestamp mods can emit duplicate IDs when saving multiple records quickly.
- `lib/pages/entry_page.dart:95-457` — Align validation with the database (either allow nullable DOB or enforce entry), fetch max file limits from `ApiService.getMaxFileSize()`, surface duplicate CRN errors gracefully, and delegate persistence to `DataService` to keep DB writes centralized; because the success snackbar code is commented out, users get no confirmation after saving.
- `lib/pages/login_page.dart:323-419` — Store the OTP countdown subscription so it can be cancelled in `dispose()`, integrate the real `ApiService` login/OTP flows, and persist auth tokens/session data for later pages; currently both login modes always succeed without verifying credentials, so access control is effectively disabled.
- `lib/pages/home_page.dart:62-160` — Replace hard-coded dashboard metrics with live counts from `LocalDBService`/`SyncService`, and wire notification actions to `NotificationService`; at present every session shows the same fake numbers.
- `lib/pages/search_page.dart:334-800` — Consolidate the sequential searches into a single SQL query (`WHERE patient_name LIKE ? OR crn LIKE ? ...`), paginate large result sets, cache extracted files with unique temp paths (and clean them up), and invoke `SyncService.syncAllData()` instead of a fixed delay; the current “Sync” button just waits two seconds then displays an offline warning.
- `lib/pages/dashboard_page.dart:409-481` — Create separate `Paint` instances per series (the current `paint..color` reuse renders everything orange) and drive the chart with real analytics data instead of new random values each repaint; toggling between list/grid simply re-randomizes charts, so the dashboard never reflects actual metrics.
- `lib/pages/profile_page.dart:17-205` — Load and save user details via a profile repository, apply theme toggles through `ThemeService`, and add validation before accepting updates; saving just shows a snackbar without persisting, so edits are lost immediately.
- `lib/pages/settings_page.dart:18-198` — Persist user preferences (dark mode, language, sync cadence), tie “Sync Now” to `SyncService`, and expose biometric settings only when the platform supports them. Every control currently mutates local state only, so leaving the screen reverts all choices and “Sync Now” never touches stored data.
- `lib/services/data_service.dart:37-44` — Propagate `_syncWithServer()` status; the method currently returns `true` even if the sync step fails, so callers cannot display meaningful error states.
- `lib/pages/dashboard_page.dart:25-28` — Use `_isGridView` to change the layout (or remove it); the toggle only swaps icons today, so the button has no effect.
- `lib/services/notification_service.dart:229-233` — Replace the zero-length `Uint8List` placeholders with the decoded files from `largeIconPath`/`bigPicturePath`; the current call produces empty bitmaps and the plugin throws when building a big-picture notification.
- `lib/services/export_service.dart:224-244` — Implement a real database backup by copying `medical_records.db`; the existing method writes a static placeholder file, so “Export backup” provides no usable data.
- `lib/pages/entry_page.dart:312-347` — Enforce `_maxFiles` before launching the picker (e.g., limit `FilePicker` to the remaining slots) to avoid loading dozens of large files only to drop them afterward; the computed `remainingSlots` is unused.
